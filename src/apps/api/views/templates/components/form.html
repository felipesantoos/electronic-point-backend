{{define "form-input"}}
<div class="mb-4">
    <label for="{{.ID}}" class="block text-sm font-medium text-gray-700 mb-1">{{.Label}}</label>
    <input type="{{default_val .Type "text"}}" id="{{.ID}}" name="{{.Name}}" value="{{default_val .Value ""}}" 
           {{if .Required}}required{{end}} {{if .ReadOnly}}readonly{{end}}
           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm text-gray-900 {{if .ReadOnly}}bg-gray-50{{end}}"
           placeholder="{{.Placeholder}}">
    {{if .HelpText}}
    <p class="mt-1 text-xs text-gray-500">{{.HelpText}}</p>
    {{end}}
</div>
{{end}}

{{define "form-select"}}
<div class="mb-4">
    <label for="{{.ID}}" class="block text-sm font-medium text-gray-700 mb-1">{{.Label}}</label>
    <select id="{{.ID}}" name="{{.Name}}" {{if .Required}}required{{end}}
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm text-gray-900">
        {{if .Placeholder}}
        <option value="">{{.Placeholder}}</option>
        {{end}}
        {{range .Options}}
        <option value="{{.Value}}" {{if is_selected .Value $.Selected}}selected{{end}}>{{.Label}}</option>
        {{end}}
    </select>
</div>
{{end}}

{{define "form-file"}}
<div class="mb-4">
    <label for="{{.ID}}" class="block text-sm font-medium text-gray-700 mb-1">{{.Label}}</label>
    <input type="file" id="{{.ID}}" name="{{.Name}}" {{if .Required}}required{{end}} accept="{{.Accept}}"
           class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
    {{if .HelpText}}
    <p class="mt-1 text-xs text-gray-500">{{.HelpText}}</p>
    {{end}}
</div>
{{end}}

{{define "form-checkbox"}}
<div class="mb-4 flex items-start">
    <div class="flex items-center h-5">
        <input id="{{.ID}}" name="{{.Name}}" type="checkbox" value="true" {{if .Checked}}checked{{end}}
               class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded">
    </div>
    <div class="ml-3 text-sm">
        <label for="{{.ID}}" class="font-medium text-gray-700">{{.Label}}</label>
        {{if .HelpText}}
        <p class="text-gray-500">{{.HelpText}}</p>
        {{end}}
    </div>
</div>
{{end}}

{{define "form-searchable-select"}}
<div class="mb-4" x-data="{ 
    open: false, 
    search: '', 
    value: '{{default_val .Selected ""}}', 
    label: '',
    options: {{marshal .Options}},
    init() {
        const selected = this.options.find(o => o.Value == this.value);
        if (selected) this.label = selected.Label;
    },
    get filteredOptions() {
        if (!this.search) return this.options;
        return this.options.filter(o => o.Label.toLowerCase().includes(this.search.toLowerCase()));
    },
    select(option) {
        this.value = option.Value;
        this.label = option.Label;
        this.open = false;
        this.search = '';
    }
}" @click.away="open = false" class="relative">
    <label for="{{.ID}}" class="block text-sm font-medium text-gray-700 mb-1">{{.Label}}</label>
    
    <div class="relative">
        <input type="text" 
               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm cursor-pointer text-gray-900"
               :placeholder="label || '{{.Placeholder}}'"
               :class="label && !search ? 'placeholder:text-gray-900' : 'placeholder:text-gray-400'"
               x-model="search"
               @click="open = true"
               @focus="open = true">
        
        <input type="hidden" name="{{.Name}}" x-model="value" {{if .Required}}required{{end}}>

        <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
            <svg class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
        </div>

        <div x-show="open" 
             x-transition:enter="transition ease-out duration-100"
             x-transition:enter-start="transform opacity-0 scale-95"
             x-transition:enter-end="transform opacity-100 scale-100"
             class="absolute z-50 mt-1 w-full bg-white shadow-lg max-h-60 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm"
             x-cloak>
            
            <template x-for="option in filteredOptions" :key="option.Value">
                <div @click="select(option)"
                     class="cursor-pointer select-none relative py-2 pl-3 pr-9 hover:bg-blue-600 hover:text-white text-gray-900 transition-colors">
                    <span x-text="option.Label" class="block truncate"></span>
                    <span x-show="value == option.Value" class="absolute inset-y-0 right-0 flex items-center pr-4">
                        <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                    </span>
                </div>
            </template>
            
            <div x-show="filteredOptions.length === 0" class="py-2 px-3 text-gray-500 italic">
                Nenhuma opção encontrada...
            </div>
        </div>
    </div>
</div>
{{end}}

{{define "form-button"}}
<button type="{{default_val .Type "submit"}}" 
        class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 {{.Class}}">
    {{if .Icon}}
    <span class="mr-2">{{.Icon}}</span>
    {{end}}
    {{.Label}}
</button>
{{end}}
