{{define "content"}}
<div class="max-w-4xl mx-auto bg-white rounded-lg shadow-sm border border-gray-200 p-6">
    <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Editar Estudante</h2>
        <p class="text-gray-600">Atualize as informações do estudante <strong>{{.Data.Student.Name}}</strong>.</p>
    </div>

    <div id="student-alerts">
        {{template "alerts" .}}
    </div>

    <form hx-put="/students/{{formatUUID .Data.Student.ID}}" hx-encoding="multipart/form-data" hx-target="body" hx-push-url="true" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Basic Info -->
            <div class="space-y-4">
                <h3 class="text-lg font-semibold text-gray-700 border-b pb-2">Informações Básicas</h3>
                {{template "form-input" dict "ID" "name" "Name" "name" "Label" "Nome Completo" "Value" .Data.Student.Name "Required" true}}
                {{template "form-input" dict "ID" "email" "Name" "email" "Label" "Email" "Type" "email" "Value" .Data.Student.Email "Required" true}}
                <div class="grid grid-cols-2 gap-4">
                    {{template "form-input" dict "ID" "cpf" "Name" "cpf" "Label" "CPF" "Value" .Data.Student.CPF "Required" true}}
                    {{template "form-input" dict "ID" "phone" "Name" "phone" "Label" "Telefone" "Value" .Data.Student.Phone "Required" true}}
                </div>
                {{template "form-input" dict "ID" "birth_date" "Name" "birth_date" "Label" "Data de Nascimento" "Type" "date" "Value" .Data.Student.BirthDate "Required" true}}
            </div>

            <!-- Academic Info -->
            <div class="space-y-4">
                <h3 class="text-lg font-semibold text-gray-700 border-b pb-2">Informações Acadêmicas</h3>
                {{template "form-input" dict "ID" "registration" "Name" "registration" "Label" "Matrícula" "Value" .Data.Student.Registration "Required" true}}
                {{template "form-select" dict "ID" "campus_id" "Name" "campus_id" "Label" "Campus" "Required" true "Options" .Data.Campus "Selected" (formatUUID .Data.Student.Campus.ID)}}
                {{template "form-select" dict "ID" "course_id" "Name" "course_id" "Label" "Curso" "Required" true "Options" .Data.Courses "Selected" (formatUUID .Data.Student.Course.ID)}}
                {{template "form-input" dict "ID" "total_workload" "Name" "total_workload" "Label" "Carga Horária Total (horas)" "Type" "number" "Value" .Data.Student.TotalWorkload "Required" true}}
            </div>
        </div>

        <!-- Profile Picture -->
        <div class="space-y-4 pt-4 border-t">
            <h3 class="text-lg font-semibold text-gray-700">Foto de Perfil</h3>
            <div class="flex items-center space-x-6">
                <div class="shrink-0">
                    {{if .Data.Student.ProfilePicture}}
                    <img id="preview" class="h-16 w-16 object-cover rounded-full" 
                         src="{{image_url .Data.Student.ProfilePicture}}" 
                         onerror="handleImageError(this)" alt="Preview">
                    {{else}}
                    <img id="preview" class="h-16 w-16 object-cover rounded-full hidden" src="" onerror="handleImageError(this)" alt="Preview">
                    <div id="no-preview" class="h-16 w-16 rounded-full bg-gray-100 flex items-center justify-center text-gray-400">
                        <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                    {{end}}
                </div>
                <label class="block">
                    <span class="sr-only">Escolher foto</span>
                    <input type="file" name="profile_picture" onchange="previewImage(this, 'preview'); if(document.getElementById('no-preview')) document.getElementById('no-preview').classList.add('hidden')"
                           class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                </label>
            </div>
        </div>

        <div class="pt-6 flex justify-end gap-3">
            <a href="/students" class="inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                Cancelar
            </a>
            {{template "form-button" dict "Label" "Salvar Alterações"}}
        </div>
    </form>
</div>
{{end}}

{{template "base" .}}
