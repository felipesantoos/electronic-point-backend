{{define "content"}}
<div class="max-w-4xl mx-auto bg-white rounded-lg shadow-sm border border-gray-200 p-6">
    <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Editar Estudante</h2>
        <p class="text-gray-600">Atualize as informações do estudante <strong>{{.Data.Student.Name}}</strong>.</p>
    </div>

    <div id="student-alerts">
        {{template "alerts" .}}
    </div>

    <form hx-put="/students/{{formatUUID .Data.Student.ID}}" hx-encoding="multipart/form-data" hx-target="body" hx-push-url="true" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Basic Info -->
            <div class="space-y-4">
                <h3 class="text-lg font-semibold text-gray-700 border-b pb-2">Informações Básicas</h3>
                {{template "form-input" dict "ID" "name" "Name" "name" "Label" "Nome Completo" "Value" .Data.Student.Name "Required" true}}
                {{template "form-input" dict "ID" "email" "Name" "email" "Label" "Email" "Type" "email" "Value" .Data.Student.Email "Required" true}}
                <div class="grid grid-cols-2 gap-4">
                    {{template "form-input" dict "ID" "cpf" "Name" "cpf" "Label" "CPF" "Value" .Data.Student.CPF "Required" true}}
                    {{template "form-input" dict "ID" "phone" "Name" "phone" "Label" "Telefone" "Value" .Data.Student.Phone "Required" true}}
                </div>
                {{template "form-input" dict "ID" "birth_date" "Name" "birth_date" "Label" "Data de Nascimento" "Type" "date" "Value" .Data.Student.BirthDate "Required" true}}
            </div>

            <!-- Academic Info -->
            <div class="space-y-4">
                <h3 class="text-lg font-semibold text-gray-700 border-b pb-2">Informações Acadêmicas</h3>
                {{template "form-input" dict "ID" "registration" "Name" "registration" "Label" "Matrícula" "Value" .Data.Student.Registration "Required" true}}
                {{template "form-select" dict "ID" "campus_id" "Name" "campus_id" "Label" "Campus" "Required" true "Options" .Data.Campus "Selected" (formatUUID .Data.Student.Campus.ID)}}
                {{template "form-select" dict "ID" "course_id" "Name" "course_id" "Label" "Curso" "Required" true "Options" .Data.Courses "Selected" (formatUUID .Data.Student.Course.ID)}}
                {{template "form-input" dict "ID" "total_workload" "Name" "total_workload" "Label" "Carga Horária Total (horas)" "Type" "number" "Value" .Data.Student.TotalWorkload "Required" true}}
            </div>
        </div>

        <!-- Profile Picture -->
        <div class="space-y-4 pt-4 border-t">
            <h3 class="text-lg font-semibold text-gray-700">Foto de Perfil</h3>
            <div class="flex items-center space-x-8">
                <div class="relative group">
                    <div class="h-24 w-24 rounded-full overflow-hidden bg-gray-100 border-2 border-dashed border-gray-300 group-hover:border-blue-400 transition-colors flex items-center justify-center">
                        {{if .Data.Student.ProfilePicture}}
                        <img id="preview" class="h-full w-full object-cover" 
                             src="{{image_url .Data.Student.ProfilePicture}}" 
                             onerror="handleImageError(this)" alt="Preview">
                        {{else}}
                        <img id="preview" class="h-full w-full object-cover hidden" src="" onerror="handleImageError(this)" alt="Preview">
                        <div id="no-preview" class="text-gray-400">
                            <svg class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                        {{end}}
                    </div>
                    <div class="absolute inset-0 rounded-full bg-black bg-opacity-0 group-hover:bg-opacity-10 transition-all pointer-events-none"></div>
                </div>
                <div class="flex-1">
                    <p class="text-sm text-gray-500 mb-2">Deseja alterar a foto? Selecione uma imagem quadrada. Máximo de 2MB.</p>
                    <label class="inline-flex items-center px-4 py-2 bg-blue-50 text-blue-700 rounded-md text-sm font-semibold cursor-pointer hover:bg-blue-100 transition-colors">
                        <span>Trocar foto</span>
                        <input type="file" name="profile_picture" class="hidden" 
                               onchange="previewImage(this, 'preview'); if(document.getElementById('no-preview')) document.getElementById('no-preview').classList.add('hidden'); document.getElementById('preview').classList.remove('hidden')">
                    </label>
                </div>
            </div>
        </div>

        <div class="pt-6 flex justify-end gap-3">
            <a href="/students" class="inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                Cancelar
            </a>
            {{template "form-button" dict "Label" "Salvar Alterações"}}
        </div>
    </form>
</div>
{{end}}

{{template "base" .}}
